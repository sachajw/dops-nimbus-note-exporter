# ==============================================================================
# Nimbus Note Exporter Configuration
# ==============================================================================
# Copy this file to .env and fill in your credentials and preferences.
# The .env file is git-ignored for security.
# ==============================================================================

# ------------------------------------------------------------------------------
# BASIC CONFIGURATION
# ------------------------------------------------------------------------------

# Your Nimbus Note email
# If not set, you will be prompted when running the tool
NIMBUS_EMAIL=your-email@example.com

# Your Nimbus Note password
# If not set, you will be prompted when running the tool
NIMBUS_PASSWORD=your-password-here

# (Optional) Export only this workspace (exact name match)
# Leave empty to export all workspaces
NIMBUS_WORKSPACE=

# (Optional) Export only this folder (exact name match)
# Leave empty to export all folders
NIMBUS_FOLDER=

# (Optional) Custom output path for the exported ZIP file
# Default: ./nimbus-export.zip
NIMBUS_OUTPUT_PATH=./nimbus-export.zip

# (Optional) Export format: html or pdf
# Default: html
NIMBUS_EXPORT_FORMAT=html

# ------------------------------------------------------------------------------
# PERFORMANCE TUNING
# ------------------------------------------------------------------------------
# Adjust these values based on your network speed and server responsiveness

# Number of parallel tag fetch requests
# Higher values = faster but may trigger rate limits
# Default: 16
NIMBUS_TAG_CONCURRENCY=16

# Number of parallel export requests submitted to the WebSocket
# RECOMMENDED: 3 (lower is more reliable for the unreliable Nimbus API)
# Default: 10
NIMBUS_EXPORT_CONCURRENCY=3

# Number of parallel file downloads
# Higher values = faster downloads but more bandwidth usage
# Default: 8
NIMBUS_DOWNLOAD_CONCURRENCY=8

# Export timeout in milliseconds
# RECOMMENDED: 600000 (10 minutes) for better reliability
# Default: 300000 (5 minutes)
NIMBUS_EXPORT_TIMEOUT=600000

# Download timeout in milliseconds
# Default: 60000 (60 seconds)
NIMBUS_DOWNLOAD_TIMEOUT=60000

# Extended wait time (ms) for delayed WebSocket job:success events
# After all exports complete, the tool waits this long for any delayed events
# RECOMMENDED: 120000 (2 minutes) - catches most delayed responses
# Default: 600000 (10 minutes)
NIMBUS_EXTENDED_WAIT=120000

# ------------------------------------------------------------------------------
# RETRY CONFIGURATION
# ------------------------------------------------------------------------------
# Control how the tool handles transient failures

# Maximum number of retry attempts for failed requests
# Set to 0 to disable retries
# Default: 3
NIMBUS_MAX_RETRIES=3

# Initial retry delay in milliseconds
# The delay doubles with each retry (exponential backoff)
# Default: 1000 (1 second)
NIMBUS_RETRY_INITIAL_DELAY=1000

# Maximum retry delay in milliseconds
# Retries won't exceed this delay regardless of attempt count
# Default: 30000 (30 seconds)
NIMBUS_RETRY_MAX_DELAY=30000

# ------------------------------------------------------------------------------
# RATE LIMITING
# ------------------------------------------------------------------------------
# Token bucket algorithm to prevent API overload

# Requests per second (token refill rate)
# Lower this if you consistently hit rate limits
# Default: 10
NIMBUS_RATE_LIMIT_RPS=10

# Burst size (max tokens available at once)
# Allows short bursts above the sustained rate
# Default: 20
NIMBUS_RATE_LIMIT_BURST=20

# ------------------------------------------------------------------------------
# RESUME & RETRY
# ------------------------------------------------------------------------------
# Options for incremental exports and recovering failed notes

# (Optional) Path to existing archive to skip already-exported notes
# Use this for multi-pass exports to avoid re-downloading successful notes
# Example: NIMBUS_RESUME_FROM=./export-pass1.zip
NIMBUS_RESUME_FROM=

# (Optional) Path to JSON file with note IDs to retry
# Only exports notes listed in the file, skips all others
# Use with failed-notes.json from a previous run
# Example: NIMBUS_RETRY_ONLY=./failed-notes.json
NIMBUS_RETRY_ONLY=

# Path to save failed note IDs for later retry
# After each export, failed notes are saved here for incremental recovery
# Default: ./failed-notes.json
NIMBUS_FAILED_NOTES_FILE=./failed-notes.json

# Enable URL prediction recovery for timed-out exports
# When exports timeout without receiving job:success, attempts to predict
# the download URL based on observed patterns
# Default: true
NIMBUS_ENABLE_URL_PREDICTION=true

# ------------------------------------------------------------------------------
# DEBUGGING
# ------------------------------------------------------------------------------
# Enable verbose logging for troubleshooting

# Set to "true" or "1" to enable debug output
# Shows WebSocket events, API responses, and internal state
# Default: false
NIMBUS_DEBUG=false
